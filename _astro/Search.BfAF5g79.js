import{o as H,i as J,r as M,s as K}from"./props.xEfNA60u.js";import{p as Q,l as B,i as U,t as O,j as W,g as n,k as R,a as T,b as X,d as c,c as d,r as h,m as L,s as v,e as Y,h as A}from"./render.CfQeIkTP.js";import{e as Z,i as ee}from"./each.BaJx-KV-.js";import{I as g,b as N,h as te}from"./Icon.puSitF5M.js";import{u as ae}from"./url-utils.CHWdgz7q.js";/* empty css                        */var re=O(`<a class="transition first-of-type:mt-2 lg:first-of-type:mt-0 group block
       rounded-xl text-lg px-3 py-2 hover:bg-[var(--btn-plain-bg-hover)] active:bg-[var(--btn-plain-bg-active)]"><div class="transition text-90 inline-flex font-bold group-hover:text-[var(--primary)]"> <!></div> <div class="transition text-xs text-white mb-1 font-mono"> </div> <div class="transition text-sm text-50"><!></div></a>`),ne=O(`<div id="search-bar" class="hidden lg:flex transition-all items-center h-10 mr-2 rounded-lg
      bg-black/[0.04] hover:bg-black/[0.06] focus-within:bg-black/[0.06]
      dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10
"><!> <input placeholder="搜索" class="transition-all pl-10 text-sm bg-transparent outline-0
         h-full w-40 active:w-60 focus:w-60 text-black/50 dark:text-white/50 svelte-wkye0l"></div> <button aria-label="Search Panel" id="search-switch" class="btn-plain scale-animation lg:!hidden rounded-lg w-10 h-10 active:scale-90"><!></button> <div id="search-panel" class="float-panel float-panel-closed search-panel absolute md:w-[30rem]
top-20 left-4 md:left-[unset] right-4 shadow-2xl rounded-2xl p-2 svelte-wkye0l"><div id="search-bar-inside" class="flex relative lg:hidden transition-all items-center h-10 rounded-xl
      bg-black/[0.04] hover:bg-black/[0.06] focus-within:bg-black/[0.06]
      dark:bg-white/5 dark:hover:bg-white/10 dark:focus-within:bg-white/10
  "><!> <input placeholder="Search" class="pl-10 absolute inset-0 text-sm bg-transparent outline-0
               focus:w-60 text-black/50 dark:text-white/50 svelte-wkye0l"></div> <!></div>`,1);function he(j,F){Q(F,!1);let u=L(""),f=L(""),m=L([]),$=[];const V=()=>{document.getElementById("search-panel")?.classList.toggle("float-panel-closed")},w=(t,a)=>{const r=document.getElementById("search-panel");!r||!a||(t?r.classList.remove("float-panel-closed"):r.classList.add("float-panel-closed"))},z=(t,a)=>{if(!a)return t;const r=new RegExp(`(${a})`,"gi");return t.replace(r,"<mark>$1</mark>")},k=async(t,a)=>{if(!t){w(!1,a),v(m,[]);return}try{const r=$.filter(e=>{const i=t.toLowerCase(),o=`${e.title} ${e.description} ${e.content}`.toLowerCase(),s=`/posts/${e.link}`;return o.includes(i)||s.toLowerCase().includes(i)||e.link.toLowerCase().includes(i)}).map(e=>{const i=e.content.toLowerCase(),o=t.toLowerCase(),s=i.indexOf(o);let l="";if(s!==-1){const p=Math.max(0,s-50),b=Math.min(e.content.length,s+100);l=e.content.substring(p,b),p>0&&(l=`...${l}`),b<e.content.length&&(l=`${l}...`)}else l=e.description||`${e.content.substring(0,150)}...`;return{url:ae(`/posts/${e.link}/`),meta:{title:e.title},excerpt:z(l,t),urlPath:`/posts/${e.link}`}});v(m,r),w(n(m).length>0,a)}catch(r){console.error("Search error:",r),v(m,[]),w(!1,a)}finally{}};H(async()=>{try{const a=await(await fetch("/rss.xml")).text(),i=new DOMParser().parseFromString(a,"text/xml").querySelectorAll("item");$=Array.from(i).map(o=>{let s="";const l=o.getElementsByTagNameNS("*","encoded")[0]?.textContent||o.querySelector("*|encoded")?.textContent||"";return l&&(s=l.replace(/<[^>]*>/g,"")),{title:o.querySelector("title")?.textContent||"",description:o.querySelector("description")?.textContent||"",content:s,link:o.querySelector("link")?.textContent?.replace(/.*\/posts\/(.*?)\//,"$1")||""}})}catch(t){console.error("Error fetching RSS:",t)}}),B(()=>n(u),()=>{k(n(u),!0)}),B(()=>n(f),()=>{k(n(f),!1)}),U(),J();var C=ne(),y=W(C),P=d(y);g(P,{icon:"material-symbols:search",class:"absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30"});var _=c(P,2);M(_),h(y);var x=c(y,2),D=d(x);g(D,{icon:"material-symbols:search",class:"text-[1.25rem]"}),h(x);var E=c(x,2),S=d(E),q=d(S);g(q,{icon:"material-symbols:search",class:"absolute text-[1.25rem] pointer-events-none ml-3 transition my-auto text-black/30 dark:text-white/30"});var I=c(q,2);M(I),h(S);var G=c(S,2);Z(G,1,()=>n(m),ee,(t,a)=>{var r=re(),e=d(r),i=d(e,!0),o=c(i);g(o,{icon:"fa6-solid:chevron-right",class:"transition text-[0.75rem] translate-x-1 my-auto text-[var(--primary)]"}),h(e);var s=c(e,2),l=d(s,!0);h(s);var p=c(s,2),b=d(p);te(b,()=>n(a).excerpt),h(p),h(r),Y(()=>{K(r,"href",n(a).url),A(i,n(a).meta.title),A(l,n(a).urlPath)}),T(t,r)}),h(E),N(_,()=>n(u),t=>v(u,t)),R("focus",_,()=>k(n(u),!0)),R("click",x,V),N(I,()=>n(f),t=>v(f,t)),T(j,C),X()}export{he as default};
